<!DOCTYPE html>
<html>
    <head>
        <style type="text/css">
          html, body, #map-canvas { height: 100%; margin: 0; padding: 0;}
        </style>
        
        <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD4C4lJDoHHkmFOqhElcI0o-Ooy2rzL070"></script>
        
        <script type="text/javascript">
            
            var geocoder = null;
            var map = null;
            var map_container = null;
        
            function init() {
                
                var opts = {
                    zoom: 8,
                    mapTypeId: google.maps.MapTypeId.TERRAIN,
                    panControl: false,
                    zoomControl: false,
                    mapTypeControl: false,
                    scaleControl: false,
                    streetViewControl: false,
                    overviewMapControl: false,
                    styles: [
                        {
                          stylers: [
                            { visibility: "on" }
                          ]
                        },{
                          featureType: "road",
                          elementType: "geometry",
                          stylers: [
                            { visibility: "off" }
                          ]
                        },
                        {
                          featureType: "landscape",
                          elementType: "geometry",
                          stylers: [
                            { visibility: "off" }
                          ]
                        }
                      ]
                };
                
                //get the parameters of the page
                var params = {};
                ( function () {
                    var match,
                        pl     = /\+/g,  // Regex for replacing addition symbol with a space
                        search = /([^&=]+)=?([^&]*)/g,
                        decode = function (s) { return decodeURIComponent(s.replace(pl, " ")); },
                        query  = window.location.search.substring(1);
                
                    while (match = search.exec(query))
                       params[decode(match[1])] = decode(match[2]);
                } )();

                
                map_container = document.getElementById('map-canvas');
                
                //should be passed or fetch element
                map = new google.maps.Map( map_container, opts );
                
                geocoder = new google.maps.Geocoder();
                
                //perform lookup of county information and resize to fit
                geocoder.geocode( { address: params[ 'name' ] + ' County, IN, US' }, function( results, state ) {
                    
                    if ( 0 < results.length) {
                        
                        var geo = results[ 0 ].geometry;
                        var bounds = new google.maps.LatLngBounds();
                	    bounds.extend( geo.bounds.getNorthEast() );
                	    bounds.extend( geo.bounds.getSouthWest() );
                	    bounds.extend( geo.location );
                	    map.fitBounds( bounds );
                	    
                	    
                	    //get information for layer here
                	    
                	    //ajax call
                	    var filter = [ '235' ];
                	    
                	    //generate the where condition
                	    var conditional = '';
                        if ( filter.length ) {
                          conditional = "'CORP_NUM' IN (" + filter.join(',') + ')';
                        }
                        //return conditional;
                	    
                	    //build the layer
                	    var districts = new google.maps.FusionTablesLayer( {
                                query: {
                                    select: 'geometry',
                                    from: '1zf_oe_OyHT_DMY9zD8wtV3joNMV0S9IC9ABsU-Q',
                                    where: conditional
                                },
                                styles: [
                                    {
                                        polygonOptions: {
                                            fillColor: "#FFFFFF",
                                            fillOpacity: 0.0
                                        },
                                        polylineOptions: {
                                            strokeColor: "#CCCCCC",
                                            strokeWeight: 1
                                        }
                                    }
                                ]
                        } );
                        
                        //set the map to display the layer on
                        districts.setMap( map );
                        
                        //add a listener to the counties layer for the click
                        google.maps.event.addListener( districts, 'click', function( evnt ) {
                            
                            document.location.href = '/statistics/' + evnt.row[ 'CORP_NUM' ].value;
                            
                        } );
                	    
                    }
                    
                } );
            }
            
            google.maps.event.addDomListener( window, 'load', init );

        </script>
        
      </head>
      <body>
    <div id="map-canvas"></div>
    </body>
</html>